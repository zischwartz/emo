#!/usr/bin/env node
require('coffee-script/register');
Emo = require('./../emo.coffee');

var emo = new Emo();

if (process.argv.length > 2) {
  // lookup mode
  var res = emo.lookup(process.argv[2], process.argv[3]);
  if (res) {
    process.stdout.write(res);
  }
  process.exit(0);
} else { 
  // piping mode
  process.stdin.resume();
  process.stdin.setEncoding('utf8');

  process.stdin.on('data', function(data) {
    process.stdout.write(emo.receive(data));
  });

  process.stdin.on('readable', function(data) {
    // Nothing mode, just exit
    if (this.read() === null) {
      process.exit(0);
    }
  });
}
